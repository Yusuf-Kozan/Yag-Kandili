@page "/kendi"
@layout AnaTaslak
@using System.Threading.Tasks
@using Esas
@using Bileşenler
@inject IJSRuntime JSruntime
@inject NavigationManager NavigationManager
@namespace sayfa

@if(oturum_açık)
{
    <div style="text-align: center;">
        <YönlendirenBaşlık ilk_başlık="Kendi Sayfanız"
        ikinci_başlık="Ana Sayfaya Git" ilk_renk="#0069ff"
        ikinci_renk="#ff6600"/>
        <br/>
        <div style="margin-top: 2%; margin-bottom: 1%;">
            <img src="@bakan_kullanıcı.RESİM" height="auto" id="resim"/>

            <div class="kutu_0_120_0" id="ortalama-beğeni">
                Beğeni: @ortalama_beğeni
            </div>
                
            <div class="kutu_0_120_0" id="takipçi-niceliği">
                Takipçi: @takipçi_niceliği
            </div>
        </div>
        <br/>
        <button class="düğme_0_120_0" disabled="@görünenler_açık"
        @onclick="AçıklarıGöster">Açık Paylaşımlarınız</button>
        <button class="düğme_9900ff" disabled="@(!görünenler_açık)"
        @onclick="GizlileriGöster">Gizli Paylaşımlarınız</button>
    </div>
    @if(görünenler_açık)
    {
        <KişininKendiAçıkPaylaşımları bakan=@kullanıcı/>
    }
    else
    {
        <BelirliKişininGizliPaylaşımları bakan=@kullanıcı/>
    }
}
else
{
    <h1 class="Yükleniyor">Yükleniyor</h1>
}

@code {
    private bool görünenler_açık {get; set;} = true;

    private void AçıklarıGöster()
    {
        görünenler_açık = true;
    }
    private void GizlileriGöster()
    {
        görünenler_açık = false;
    }

    private double ortalama_beğeni;
    private long takipçi_niceliği;

    private string kullanıcı, oturum;
    private bool oturum_açık;
    internal static ÜyeBil bakan_kullanıcı;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        try
        {
            var a = await JSruntime.InvokeAsync<string>("Çerezİşleri.ÇerezOku", "kullanıcı");
            kullanıcı = a.ToString(); a = null;
            var b = await JSruntime.InvokeAsync<string>("Çerezİşleri.ÇerezOku", "oturum");
            oturum = b.ToString(); b = null;
            devam();
            StateHasChanged();
        }
        catch
        {
            NavigationManager.NavigateTo("/");
        }
    }
    private void devam()
    {
        oturum_açık = Esas.VeriTabanı.Oturum.BuOturumAçık(oturum, kullanıcı);
        if (!oturum_açık)
        {
            NavigationManager.NavigateTo("/");
        }
        bakan_kullanıcı = Esas.VeriTabanı.Üyelik.ÜyeBilgileri(kullanıcı);
        ortalama_beğeni = Esas.VeriTabanı.Beğeni.KişininBeğeniOrtalaması(kullanıcı);
        takipçi_niceliği = Esas.VeriTabanı.Takip.TakipçiNiceliği(kullanıcı);
    }
}