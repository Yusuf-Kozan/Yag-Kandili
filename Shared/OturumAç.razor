@using Esas
@using Kilnevüg
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

@namespace Bileşenler

<div class="form" style="display: block; text-align: center;">
    @if(Başlık == "Giriş Yap")
    {
        <h4 class="formBaşlık" style="color:rgb(0,120,0); font-size: x-large;">@Başlık</h4>
    }
    else
    {
        <h4 class="formBaşlık" style="color:#4169e1; font-size: x-large;">@Başlık</h4>
    }
    <div><input type="text" placeholder="Kullanıcı Adı" id="cKullanıcıAdı" class="MetinKutusu1" @bind="girBil[0]"/></div>
    <div><input type="password" placeholder="Parola" id="cParola" class="MetinKutusu1" @bind="girBil[1]"/></div>
    <div><button class="D1" @onclick="cGiriş">Giriş Yap</button>
    <button class="D2" @onclick="cParolaSıfırla">Parola Sıfırla</button></div>
</div>

@code {
    [Parameter]
    public string yön {get; set;}

    private string Başlık = "Giriş Yap";
    private string[] girBil = new string[2]; //0 = kulad, 1 = parol
    private void cGiriş()
    {
        string kulad = girBil[0];
        string parol = girBil[1];
        if (!Girdiler.allAreNullOrWhiteSpace(girBil))
        {
            if (!Girdiler.tümMetinlerUygun(girBil))
            {
                Başlık = "Kullanıcı Adınızı veya Parolanızı Hatalı Girdiniz";
            }
            else if (TabanlıVeri.KP_Kullanımda(kulad,parol))
            {
                Başlık = "Giriş Yap";
                İşlemler.Oturumİşlemleri.Oturum_Başlat(kulad, JSRuntime);
                if(String.IsNullOrWhiteSpace(yön))
                    NavigationManager.NavigateTo("/ana");
                else
                    NavigationManager.NavigateTo(yön);
            }
            else
            {
                Başlık = "Kullanıcı Adınızı veya Parolanızı Hatalı Girdiniz";
            }
        }
        else
        {
            Başlık = "Kullanıcı Adınızı veya Parolanızı Girmediniz";
        }
        kulad = null;
        parol = null;
    }

    private void cParolaSıfırla()
    {}
}