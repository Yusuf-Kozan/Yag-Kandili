@using Esas
@using Kilnevüg
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

@namespace Bileşenler

<div style="display: block; text-align: center; font-family: sans-serif; width: 90%;
margin:auto; max-width:15cm; padding-bottom: 5%;">
    @if(Başlık == "Giriş Yap")
    {
        <h4 style="color:rgb(0,120,0); font-size: xx-large;">@Başlık</h4>
    }
    else
    {
        <h4 style="color:#4169e1; font-size: xx-large;">@Başlık</h4>
    }
    <div><input type="text" style="width:100%;" placeholder="Kullanıcı Adı" class="MetinKutusu1" @bind="kullanıcı_adı"/></div>
    <div><input type="password" style="width:100%;" placeholder="Parola" class="MetinKutusu1" @bind="parola"/></div>
    <div><button class="D1" @onclick="GirişYap">Giriş Yap</button>
    <button class="D2" @onclick="ParolaSıfırla">Parola Sıfırla</button></div>
</div>

@code {
    [Parameter]
    public string yön {get; set;}

    private string Başlık = "Giriş Yap";
    private string kullanıcı_adı, parola;
    private void GirişYap()
    {
        if (String.IsNullOrWhiteSpace(kullanıcı_adı) || String.IsNullOrWhiteSpace(parola))
        {
            Başlık = "Giriş Reddedildi";
        }
        else if (Esas.VeriTabanı.Üyelik.KullanıcıAdıKullanımda(kullanıcı_adı))
        {
            string kullanıcı_kimliği = Esas.VeriTabanı.Üyelik.KullanıcınınKimliği(kullanıcı_adı);
            string parola_bilgileri = Esas.VeriTabanı.Üyelik.KullanıcınınParolaBilgileri(kullanıcı_kimliği);
            if (Parolalar.ParolaDoğru(parola_bilgileri, parola))
            {
                Başlık = "Giriş Yap";
                İşlemler.Oturumİşlemleri.Oturum_Başlat(kullanıcı_adı, JSRuntime);
                if(String.IsNullOrWhiteSpace(yön))
                    NavigationManager.NavigateTo("/ana");
                else
                    NavigationManager.NavigateTo(yön);
            }
            else
            {
                Başlık = "Giriş Reddedildi";
            }
        }
    }
    private void ParolaSıfırla()
    {}
}